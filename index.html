<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Worduello</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <meta name="theme-color" content="#4f8cff"/>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
:root {
  --bg: #f7f8fa;
  --fg: #222;
  --tile-gray: #b0b4ba;
  --tile-yellow: #f3c237;
  --tile-green: #63c97d;
  --tile-border: #d5d7dc;
  --tile-bg: #fff;
  --accent: #4f8cff;
  --accent-dark: #3267d6;
  --shadow: 0 4px 24px #0001;
  --modal-bg: #0009;
}
[data-theme="dark"] {
  --bg: #16171a;
  --fg: #f1f1f1;
  --tile-gray: #393c41;
  --tile-yellow: #bb9e2d;
  --tile-green: #3ea75a;
  --tile-border: #2a2c30;
  --tile-bg: #202126;
  --accent: #42a5f5;
  --accent-dark: #285ea8;
  --shadow: 0 4px 24px #0007;
  --modal-bg: #222d;
}
body {
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  min-height: 100vh;
  font-family: 'Roboto', Arial, sans-serif;
  transition: background 0.2s, color 0.2s;
}
.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 18px 12px 0 12px;
  margin-bottom: 5px;
}
h1 {
  font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
  letter-spacing: 1.5px;
  font-size: 2em;
  font-weight: 600;
  color: var(--accent);
  margin: 0 0 8px 0;
  text-shadow: 0 2px 16px #0001;
  user-select: none;
  cursor: pointer;
}
#theme-toggle, #show-bracket {
  border: none;
  background: var(--accent);
  color: #fff;
  border-radius: 50%;
  width: 44px;
  height: 44px;
  font-size: 1.35em;
  cursor: pointer;
  transition: background 0.2s, box-shadow 0.2s;
  box-shadow: var(--shadow);
  margin-left: 0;
  margin-right: 0;
}
#show-bracket {
  border-radius: 10px;
  width: auto;
  height: 44px;
  font-size: 1em;
  padding: 0 16px;
  margin-left: 10px;
  font-weight: 600;
  letter-spacing: 0.06em;
  display: none;
}
#theme-toggle:active, #show-bracket:active { transform: scale(0.96);}
#theme-toggle:hover, #show-bracket:hover { background: var(--accent-dark);}
#main-menu {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  margin: 60px auto 0 auto;
  max-width: 330px;
  gap: 24px;
}
.menu-btn {
  width: 100%;
  max-width: 260px;
  padding: 18px 0;
  font-size: 1.16em;
  font-family: 'Montserrat', Arial, sans-serif;
  font-weight: 700;
  color: #fff;
  background: var(--accent);
  border: none;
  border-radius: 14px;
  margin: 0 auto;
  box-shadow: 0 2px 14px #4f8cff15;
  cursor: pointer;
  transition: background 0.19s, transform 0.16s;
  letter-spacing: 0.04em;
  outline: none;
  margin-bottom: 5px;
  margin-top: 0;
}
.menu-btn:active { transform: scale(0.97);}
.menu-btn:hover { background: var(--accent-dark);}
#howtoplay-modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0; top: 0; width: 100%; height: 100%;
  background: var(--modal-bg);
  align-items: center;
  justify-content: center;
}
#howtoplay-modal .modal-content {
  background: var(--tile-bg);
  margin: 30px auto;
  padding: 22px 16px 19px 16px;
  border-radius: 16px;
  box-shadow: var(--shadow);
  width: 96vw;
  max-width: 420px;
  position: relative;
  min-height: 110px;
  color: var(--fg);
}
#howtoplay-modal .close {
  color: var(--accent-dark);
  position: absolute;
  top: 10px;
  right: 18px;
  font-size: 2em;
  font-weight: bold;
  cursor: pointer;
  transition: color 0.17s;
  z-index: 3;
}
#howtoplay-modal .close:hover {
  color: #f43b3b;
}
@media (max-width: 600px) {
  #main-menu {
    margin-top: 34px;
    max-width: 99vw;
  }
  .menu-btn {
    max-width: 99vw;
    font-size: 1.06em;
    padding: 14px 0;
  }
}
#game-setup {
  background: var(--tile-bg);
  border-radius: 18px;
  box-shadow: var(--shadow);
  margin: 18px auto 22px auto;
  max-width: 410px;
  padding: 28px 14px 18px 14px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  align-items: stretch;
  border: 1.5px solid var(--tile-border);
}
#game-setup label {
  font-size: 1.08em;
  margin-bottom: 5px;
  font-weight: 500;
  color: var(--accent-dark);
  letter-spacing: 0.03em;
}
select, input[type="number"], .player-name-input {
  font-size: 1.08em;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1.5px solid var(--tile-border);
  margin-top: 5px;
  background: var(--tile-bg);
  color: var(--fg);
  outline: none;
  box-sizing: border-box;
  transition: border 0.18s;
}
select:focus, input[type="number"]:focus, .player-name-input:focus {
  border: 2px solid var(--accent);
}
.player-name-input {
  margin-bottom: 6px;
  width: 100%;
}
#player-names label {
  font-size: 1em;
  margin-bottom: 2px;
  display: block;
  color: var(--fg);
}
button, #restart-normal {
  background: var(--accent);
  color: #fff;
  padding: 10px 0;
  border-radius: 10px;
  border: none;
  font-size: 1.08em;
  font-family: inherit;
  font-weight: 600;
  cursor: pointer;
  margin-top: 8px;
  box-shadow: 0 2px 10px #0001;
  transition: background 0.18s, transform 0.15s;
  letter-spacing: 0.03em;
}
button:active, #restart-normal:active { transform: scale(0.97);}
button:hover, #restart-normal:hover { background: var(--accent-dark);}
#tournament, #normal-match {
  margin: 0 auto 45px auto;
  max-width: 600px;
  padding: 14px 2px;
}
#round-info {
  font-size: 1.15em;
  margin-bottom: 13px;
  text-align: center;
  color: var(--accent-dark);
  font-weight: 500;
  letter-spacing: 0.03em;
}
.match-block {
  background: var(--tile-bg);
  border-radius: 15px;
  margin: 24px auto 0 auto;
  padding: 18px 8px 22px 8px;
  max-width: 370px;
  box-shadow: var(--shadow);
  border: 1.5px solid var(--tile-border);
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
.match-block h2 {
  margin: 0 0 12px 0;
  font-size: 1.07em;
  color: var(--accent);
  letter-spacing: 0.04em;
}
.player-secret {
  background: var(--tile-bg);
  border-radius: 11px;
  box-shadow: 0 1.5px 8px #0001;
  padding: 12px 10px;
  margin-bottom: 8px;
  border: 1.2px solid var(--tile-border);
  display: flex;
  flex-direction: column;
  align-items: center;
  max-width: 310px;
  margin-left: auto;
  margin-right: auto;
  font-size: 1.08em;
}
.player-secret b {
  color: var(--accent-dark);
  font-size: 1.07em;
  margin-bottom: 6px;
  letter-spacing: 0.02em;
}
.word-input {
  font-size: 1.32em;
  font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
  font-weight: 600;
  letter-spacing: 8px;
  width: 170px;
  text-align: center;
  background: linear-gradient(101deg, #e3e7ee 30%, #c6d2e3 100%);
  color: #2c2c2c;
  border: 2.5px solid var(--accent);
  border-radius: 12px;
  box-shadow: 0 2px 12px #4f8cff22, 0 0.5px 1.5px #0002;
  outline: none;
  margin: 13px 0 8px 0;
  padding: 11px 0;
  transition: border 0.15s, box-shadow 0.15s;
}
[data-theme="dark"] .word-input {
  background: linear-gradient(101deg, #23272f 30%, #363c44 100%);
  color: #f5f8fa;
  border: 2.5px solid var(--accent);
  box-shadow: 0 2px 12px #42a5f544, 0 0.5px 1.5px #0004;
}
.word-input:focus {
  border: 2.5px solid #4f8cff;
  box-shadow: 0 4px 16px #4f8cff22;
}
.tile {
  width: 44px;
  height: 44px;
  border-radius: 8px;
  font-size: 1.3em;
  font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 2px;
  box-shadow: 0 2px 7px #0002, 0 0.5px 1.5px #0004;
  border: none;
  transition: background 0.18s, color 0.18s, box-shadow 0.18s, scale 0.16s;
  letter-spacing: 0.02em;
  color: #fff;
  user-select: none;
  font-feature-settings: "locl" 0, "case" 0, "liga" 1;
}
.tile span.turkish-i {
  font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
  font-weight: 700;
  font-size: inherit;
  letter-spacing: inherit;
  font-feature-settings: "locl" 1;
}
.tile.green {
  background: linear-gradient(145deg, #01b41b 55%, #2cc74f 100%);
  box-shadow: 0 2px 9px #2cc74f55;
  color: #fff;
  scale: 1.09;
  border: 2.5px solid #2cc74f;
  text-shadow: 0 1px 6px #0006;
}
.tile.yellow {
  background: linear-gradient(145deg, #b19700 55%, #fedf4a 100%);
  box-shadow: 0 2px 9px #fedf4a55;
  color: #fffbea;
  scale: 1.09;
  border: 2.5px solid #fedf4a;
  text-shadow: 0 1px 5px #0005;
}
.tile.gray {
  background: linear-gradient(145deg, #444 60%, #222 100%);
  box-shadow: 0 2px 7px #0006;
  color: #f1f1f1;
  border: 2.2px solid #444;
  text-shadow: 0 1px 4px #0007;
  opacity: 0.93;
}
@media (max-width: 600px) {
  .tile { width: 30px; height: 30px; font-size: 1em; }
  .word-input { width: 95vw; max-width: 140px; font-size: 1em; letter-spacing: 4px;}
  .player-secret { padding: 8px 2px; }
}
.guess-area {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 12px 0 4px 0;
  align-items: center;
}
.guess-input {
  font-size: 1.35em;
  font-family: inherit;
  width: 135px;
  max-width: 40vw;
  padding: 12px 10px;
  border-radius: 10px;
  border: 2.2px solid var(--tile-border);
  outline: none;
  background: var(--tile-bg);
  color: var(--fg);
  box-shadow: 0 2px 10px #0002;
  letter-spacing: 7px;
  text-align: center;
  transition: border 0.2s, box-shadow 0.2s;
}
.guess-input:focus {
  border: 2.2px solid var(--accent);
  box-shadow: 0 4px 16px #4f8cff33;
}
#guess-btn {
  font-size: 1.13em;
  padding: 11px 22px;
  border-radius: 10px;
  background: var(--accent);
  font-weight: 600;
  color: #fff;
  border: none;
  box-shadow: 0 2px 8px #0001;
  cursor: pointer;
  transition: background 0.15s, transform 0.15s;
  letter-spacing: 0.03em;
  outline: none;
}
#guess-btn:active { transform: scale(0.96);}
#guess-btn:hover, #guess-btn:focus { background: var(--accent-dark);}
.board {
  margin: 12px 0 10px 0;
}
.row {
  display: flex;
  justify-content: center;
}
.match-feedback {
  font-size: 1em;
  color: #f43b3b;
  min-height: 20px;
  margin-bottom: 3px;
  font-weight: 500;
  letter-spacing: 0.01em;
}
.eliminated {
  opacity: 0.5;
}
#tournament-winner {
  background: var(--tile-green);
  color: #fff;
  border-radius: 15px;
  margin: 22px auto 0 auto;
  padding: 18px 11px;
  text-align: center;
  font-size: 1.2em;
  max-width: 310px;
  box-shadow: var(--shadow);
  font-weight: bold;
  letter-spacing: 0.04em;
}
.modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0; top: 0; width: 100%; height: 100%;
  background: var(--modal-bg);
  align-items: center;
  justify-content: center;
}
.modal-content {
  background: var(--tile-bg);
  margin: 30px auto;
  padding: 19px 5px 15px 5px;
  border-radius: 15px;
  box-shadow: var(--shadow);
  width: 98vw;
  max-width: 700px;
  position: relative;
  min-height: 110px;
}
.close {
  color: var(--accent-dark);
  position: absolute;
  top: 10px;
  right: 18px;
  font-size: 2em;
  font-weight: bold;
  cursor: pointer;
  transition: color 0.17s;
  z-index: 3;
}
.close:hover {
  color: #f43b3b;
}
#svg-bracket-container {
  width: 100%;
  min-height: 320px;
  max-width: 700px;
  margin: 0 auto;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  overflow-x: auto;
  background: none;
}
#svg-bracket {
  width: 100%;
  height: 340px;
  display: block;
  background: none;
}
.svg-bracket-text {
  font-family: 'Montserrat', Arial, sans-serif;
  font-size: 15px;
  fill: #222;
  pointer-events: none;
  text-anchor: middle;
  dominant-baseline: middle;
}
.svg-bracket-winner {
  fill: #63c97d;
  font-weight: bold;
}
.svg-bracket-current {
  fill: #4f8cff;
  font-weight: bold;
}
@media (max-width: 600px) {
  #svg-bracket-container { min-height: 200px; }
  #svg-bracket { height: 220px; }
  .svg-bracket-text { font-size: 10px;}
  .tile { width: 30px; height: 30px; font-size: 1em; }
  .word-input { width: 95vw; max-width: 140px; font-size: 1em; letter-spacing: 4px;}
  .player-secret { padding: 8px 2px; }
}
#guess-timer {
  margin: 8px 0 0 0;
  color: var(--accent-dark);
  font-size: 1.08em;
  font-weight: 500;
  letter-spacing: 0.04em;
  text-align: center;
}
#giveup-btn {
  background: #f43b3b;
  color: #fff;
  padding: 7px 20px;
  border-radius: 9px;
  border: none;
  font-size: 1em;
  font-family: inherit;
  font-weight: 600;
  cursor: pointer;
  margin: 8px auto 0 auto;
  box-shadow: 0 1px 6px #0002;
  transition: background 0.16s;
  display: inline-block;
}
#giveup-btn:hover { background: #bb1b1b; }
  </style>
</head>
<body>
<div class="top-bar">
  <h1 id="logo-title">Worduello</h1>
  <div>
    <button id="theme-toggle" title="Koyu/Açık Tema">🌙</button>
    <button id="show-bracket" style="display:none;">Turlar</button>
  </div>
</div>
<div id="main-menu">
  <button id="menu-match" class="menu-btn">Maç</button>
  <button id="menu-tournament" class="menu-btn">Turnuva</button>
  <button id="menu-howtoplay" class="menu-btn">Nasıl Oynanır</button>
</div>
<div id="game-setup" style="display:none;">
  <label>Oyun Türü:
    <select id="game-mode">
      <option value="normal">Normal Maç</option>
      <option value="tournament">Turnuva</option>
    </select>
  </label>
  <label>Kelime Uzunluğu:
    <select id="word-length">
      <option value="4">4</option>
      <option value="5" selected>5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
    </select>
  </label>
  <label id="player-count-label" style="display:none;">Oyuncu Sayısı:
    <input type="number" id="player-count" min="2" max="8" value="4" style="width:50px">
  </label>
  <div id="player-names"></div>
  <button id="start-game">Oyunu Başlat</button>
</div>
<div id="tournament" style="display:none;">
  <div id="round-info"></div>
  <div id="match-area"></div>
  <button id="next-round" style="display:none;">Sonraki Tur</button>
  <div id="tournament-winner" style="display:none;"></div>
</div>
<div id="normal-match" style="display:none;">
  <div id="normal-match-area"></div>
  <button id="restart-normal" style="display:none;">Tekrar Oyna</button>
</div>
<div id="bracket-modal" class="modal">
  <div class="modal-content">
    <span class="close" id="bracket-close">&times;</span>
    <h2 style="margin-left:10px;">Turnuva Şeması</h2>
    <div id="svg-bracket-container"><svg id="svg-bracket"></svg></div>
  </div>
</div>
<div id="howtoplay-modal">
  <div class="modal-content">
    <span class="close" id="howtoplay-close">&times;</span>
    <h2 style="margin:0 0 16px 0;">Nasıl Oynanır?</h2>
    <div style="line-height:1.5;font-size:1.04em;">
      <b>Maç:</b> İki oyuncu sırayla birbirlerinin gizli kelimesini bulmaya çalışır.<br><br>
      <b>Turnuva:</b> 2 veya daha fazla oyuncuyla, eşleşmelerle eleme usulü oynanır.<br><br>
      <b>Kurallar:</b>
      <ul style="margin:8px 0 0 16px;padding:0;">
        <li>Her oyuncu kendi gizli kelimesini belirler.</li>
        <li>Karşı oyuncu, kelimenin uzunluğuna uygun tahminler yapar.</li>
        <li>Harflerin yeri ve varlığı kutucuk renkleriyle gösterilir.</li>
        <li>İstediğiniz kadar deneme hakkınız vardır veya pes edebilirsiniz.</li>
      </ul>
      <b>Renkler:</b> <span style="color:#63c97d;">Yeşil</span>: Doğru harf/doğru yer, <span style="color:#f3c237;">Sarı</span>: Doğru harf/yanlış yer, <span style="color:#b0b4ba;">Gri</span>: Yanlış harf<br>
    </div>
  </div>
</div>
<script>
const themeToggle = document.getElementById("theme-toggle");
const root = document.documentElement;
function setTheme(theme) {
  root.setAttribute("data-theme", theme);
  localStorage.setItem("theme", theme);
}
themeToggle.onclick = () => {
  const isDark = root.getAttribute("data-theme") === "dark";
  setTheme(isDark ? "light" : "dark");
  themeToggle.textContent = isDark ? "🌙" : "☀️";
};
setTheme(localStorage.getItem("theme") || "light");
themeToggle.textContent = root.getAttribute("data-theme") === "dark" ? "☀️" : "🌙";
const mainMenu = document.getElementById("main-menu");
const gameSetup = document.getElementById("game-setup");
const menuMatch = document.getElementById("menu-match");
const menuTournament = document.getElementById("menu-tournament");
const menuHowToPlay = document.getElementById("menu-howtoplay");
menuMatch.onclick = () => {
  mainMenu.style.display = "none";
  gameSetup.style.display = "";
  document.getElementById("game-mode").value = "normal";
  document.getElementById("player-count-label").style.display = "none";
  renderPlayerInputs();
};
menuTournament.onclick = () => {
  mainMenu.style.display = "none";
  gameSetup.style.display = "";
  document.getElementById("game-mode").value = "tournament";
  document.getElementById("player-count-label").style.display = "";
  renderPlayerInputs();
};
menuHowToPlay.onclick = () => {
  document.getElementById("howtoplay-modal").style.display = "flex";
};
document.getElementById("howtoplay-close").onclick = () => {
  document.getElementById("howtoplay-modal").style.display = "none";
};
window.onclick = function(event) {
  if (event.target == document.getElementById("howtoplay-modal")) {
    document.getElementById("howtoplay-modal").style.display = "none";
  }
};
document.getElementById("logo-title").onclick = function() {
  mainMenu.style.display = "";
  gameSetup.style.display = "none";
  document.getElementById("tournament").style.display = "none";
  document.getElementById("normal-match").style.display = "none";
  document.getElementById("bracket-modal").style.display = "none";
  document.getElementById("howtoplay-modal").style.display = "none";
};
const gameModeSelect = document.getElementById("game-mode");
const playerCountLabel = document.getElementById("player-count-label");
const playerCountInput = document.getElementById("player-count");
const playerNamesDiv = document.getElementById("player-names");
function renderPlayerInputs() {
  const isTournament = gameModeSelect.value === "tournament";
  playerCountLabel.style.display = isTournament ? "" : "none";
  const count = isTournament ? (parseInt(playerCountInput.value) || 2) : 2;
  playerNamesDiv.innerHTML = "";
  for (let i = 0; i < count; i++) {
    const label = document.createElement("label");
    label.textContent = `Oyuncu ${i + 1} Adı:`;
    const input = document.createElement("input");
    input.type = "text";
    input.className = "player-name-input";
    input.maxLength = 18;
    input.placeholder = `Oyuncu ${i + 1}`;
    input.value = `Oyuncu ${i + 1}`;
    input.id = `player-name-${i}`;
    label.appendChild(input);
    playerNamesDiv.appendChild(label);
  }
}
gameModeSelect.addEventListener("change", renderPlayerInputs);
playerCountInput.addEventListener("input", renderPlayerInputs);
renderPlayerInputs();
const wordLengthInput = document.getElementById("word-length");
const startGameBtn = document.getElementById("start-game");
const tournamentDiv = document.getElementById("tournament");
const matchArea = document.getElementById("match-area");
const roundInfo = document.getElementById("round-info");
const nextRoundBtn = document.getElementById("next-round");
const winnerDiv = document.getElementById("tournament-winner");
const normalMatchDiv = document.getElementById("normal-match");
const normalMatchArea = document.getElementById("normal-match-area");
const restartNormalBtn = document.getElementById("restart-normal");
const showBracketBtn = document.getElementById("show-bracket");
const bracketModal = document.getElementById("bracket-modal");
const bracketClose = document.getElementById("bracket-close");
const bracketContainer = document.getElementById("svg-bracket-container");
let wordLength = 5;
let playerCount = 2;
let players = [];
let eliminated = [];
let roundMatches = [];
let currentMatchIndex = 0;
let roundNumber = 1;
let maxTries = 6;
let nextRoundPlayers = [];
let gameMode = "normal";
let bracketData = [];
let bracketWinners = [];
let bracketPlayers = [];
let bracketGames = [];
let bracketCurrentRound = 1;
let bracketTotalRounds = 0;
function getBracketRounds(n) {
  let r = 0;
  while (n > 1) { n = Math.ceil(n/2); r++; }
  return r;
}
function resetBracketModel(playerNames) {
  bracketPlayers = playerNames.slice();
  bracketTotalRounds = getBracketRounds(playerNames.length);
  bracketWinners = [];
  bracketGames = [];
  let roundPlayers = playerNames.slice();
  for (let r=0; r<bracketTotalRounds; r++) {
    let matches = [];
    for (let i=0; i<Math.ceil(roundPlayers.length/2); i++) {
      matches.push({
        p1: roundPlayers[2*i]   || null,
        p2: roundPlayers[2*i+1] || null,
        winner: null
      });
    }
    bracketGames.push(matches);
    roundPlayers = Array(matches.length).fill('?');
  }
}
function getRoundName(round, playerCount) {
  let n = 1;
  while (n < playerCount) n *= 2;
  const remain = n / Math.pow(2, round - 1);
  if (remain === 32) return "Son 32";
  if (remain === 16) return "Son 16";
  if (remain === 8) return "Çeyrek Final";
  if (remain === 4) return "Yarı Final";
  if (remain === 2) return "Final";
  return round + ". Tur";
}
function renderTurkishLetter(letter) {
  if (letter === "i") return '<span class="turkish-i">İ</span>';
  if (letter === "I") return '<span class="turkish-i">I</span>';
  return letter.toUpperCase();
}
function renderBoard(container, board) {
  container.innerHTML = "";
  for (let row of board) {
    const rowDiv = document.createElement("div");
    rowDiv.className = "row";
    for (let i = 0; i < row.guess.length; i++) {
      const tile = document.createElement("div");
      tile.className = "tile " + row.feedback[i];
      tile.innerHTML = renderTurkishLetter(row.guess[i]);
      rowDiv.appendChild(tile);
    }
    container.appendChild(rowDiv);
  }
}
startGameBtn.onclick = () => {
  wordLength = parseInt(wordLengthInput.value);
  gameMode = gameModeSelect.value;
  if (gameMode === "tournament") {
    playerCount = parseInt(playerCountInput.value);
  } else {
    playerCount = 2;
  }
  players = [];
  for (let i = 0; i < playerCount; i++) {
    const nameInput = document.getElementById(`player-name-${i}`);
    let name = nameInput && nameInput.value.trim() ? nameInput.value.trim().slice(0,18) : `Oyuncu ${i+1}`;
    players.push({ name, eliminated: false, score: 0 });
  }
  eliminated = [];
  roundNumber = 1;
  nextRoundPlayers = [...players];
  gameSetup.style.display = "none";
  if (gameMode === "tournament") {
    tournamentDiv.style.display = "";
    winnerDiv.style.display = "none";
    bracketData = [];
    showBracketBtn.style.display = "";
    resetBracketModel(players.map(p => p.name));
    startRound();
    normalMatchDiv.style.display = "none";
  } else {
    tournamentDiv.style.display = "none";
    winnerDiv.style.display = "none";
    showBracketBtn.style.display = "none";
    startNormalMatch();
    normalMatchDiv.style.display = "";
  }
};
function updateBracketAfterMatch(roundIdx, matchIdx, winnerName) {
  bracketGames[roundIdx][matchIdx].winner = winnerName;
  if (bracketGames[roundIdx+1]) {
    let nextIdx = Math.floor(matchIdx/2);
    if (bracketGames[roundIdx+1][nextIdx]) {
      if (matchIdx%2===0) bracketGames[roundIdx+1][nextIdx].p1 = winnerName;
      else                bracketGames[roundIdx+1][nextIdx].p2 = winnerName;
    }
  }
}
function showNextMatch() {
  matchArea.innerHTML = "";
  if (currentMatchIndex >= roundMatches.length) {
    nextRoundPlayers = roundMatches.map(m => m.find(p => !p.eliminated));
    nextRoundBtn.style.display = "";
    nextRoundBtn.onclick = () => {
      roundNumber++;
      startRound();
    };
    if (roundMatches.length > 0) nextRoundBtn.style.display = "";
    return;
  }
  const [p1, p2] = roundMatches[currentMatchIndex];
  createMatchBlock(p1, p2, matchArea, (winnerName, loserName) => {
    updateBracketAfterMatch(roundNumber-1, currentMatchIndex, winnerName);
    currentMatchIndex++;
    showNextMatch();
  });
}
async function turkceKelimeVarMi(kelime) {
  try {
    const response = await fetch("https://sozluk.gov.tr/gts?ara=" + encodeURIComponent(kelime));
    if (!response.ok) return false;
    const data = await response.json();
    return Array.isArray(data) && data.length > 0;
  } catch {
    return false;
  }
}
function startRound() {
  let totalPlayers = players.length;
  let roundLabel = getRoundName(roundNumber, totalPlayers);
  roundInfo.textContent = `${roundLabel} - Eşleşmeler`;
  matchArea.innerHTML = "";
  roundMatches = [];
  currentMatchIndex = 0;
  nextRoundBtn.style.display = "none";
  winnerDiv.style.display = "none";
  let arr = nextRoundPlayers.filter(p => !p.eliminated);
  if (arr.length === 1) {
    winnerDiv.innerHTML = `<b>${arr[0].name}!</b> turnuvayı kazandı 🏆`;
    winnerDiv.style.display = "";
    matchArea.innerHTML = "";
    roundInfo.textContent = "Turnuva Bitti";
    nextRoundBtn.style.display = "none";
    return;
  }
  let roundIdx = roundNumber - 1;
  let matches = bracketGames[roundIdx];
  for (let m=0; m<matches.length; m++) {
    let name1 = matches[m].p1 || "?";
    let name2 = matches[m].p2 || "?";
    let p1 = players.find(p=>p.name===name1) || {name: name1, eliminated: name1==="?"};
    let p2 = players.find(p=>p.name===name2) || {name: name2, eliminated: name2==="?"};
    roundMatches.push([p1, p2]);
  }
  showNextMatch();
}
function startNormalMatch() {
  normalMatchArea.innerHTML = "";
  restartNormalBtn.style.display = "none";
  createMatchBlock(players[0], players[1], normalMatchArea, () => {
    restartNormalBtn.style.display = "";
  });
}
restartNormalBtn.onclick = () => {
  startNormalMatch();
};
function createMatchBlock(player1, player2, container, onComplete) {
  let secretWords = ["", ""];
  container.innerHTML = `
    <div class="match-block">
      <h2>${player1.name} vs ${player2.name}</h2>
      <div id="secret1" class="player-secret">
        <b>${player1.name}</b> kelimenizi girin: 
        <input type="password" id="secret-word-1" class="word-input" maxlength="${wordLength}">
        <button id="secret-btn-1">Onayla</button>
        <span id="secret-feedback-1" class="match-feedback"></span>
      </div>
      <div id="secret2" class="player-secret" style="display:none;">
        <b>${player2.name}</b> kelimenizi girin: 
        <input type="password" id="secret-word-2" class="word-input" maxlength="${wordLength}">
        <button id="secret-btn-2">Onayla</button>
        <span id="secret-feedback-2" class="match-feedback"></span>
      </div>
      <div id="guess-phase" style="display:none;">
        <div id="guess-turn"></div>
        <div id="match-board"></div>
        <div class="guess-area">
          <input type="text" id="guess-input" class="guess-input" maxlength="${wordLength}" autocomplete="off">
          <button id="guess-btn"><span style="font-size:1.1em;">🔎</span> Tahmin Et</button>
        </div>
        <div id="guess-feedback" class="match-feedback"></div>
        <div id="match-result-area"></div>
      </div>
    </div>
  `;
  document.getElementById("secret-btn-1").onclick = async () => {
    const val = document.getElementById("secret-word-1").value.toLowerCase().trim();
    if (!validateWord(val)) {
      document.getElementById("secret-feedback-1").textContent = "Sadece harf ve uygun uzunluk!";
      return;
    }
    document.getElementById("secret-feedback-1").textContent = "Kelime kontrol ediliyor...";
    if (!(await turkceKelimeVarMi(val))) {
      document.getElementById("secret-feedback-1").textContent = "Bu kelime Türkçe sözlükte yok!";
      return;
    }
    secretWords[0] = val;
    document.getElementById("secret1").style.display = "none";
    document.getElementById("secret2").style.display = "";
    document.getElementById("secret-word-2").focus();
  };
  document.getElementById("secret-btn-2").onclick = async () => {
    const val = document.getElementById("secret-word-2").value.toLowerCase().trim();
    if (!validateWord(val)) {
      document.getElementById("secret-feedback-2").textContent = "Sadece harf ve uygun uzunluk!";
      return;
    }
    document.getElementById("secret-feedback-2").textContent = "Kelime kontrol ediliyor...";
    if (!(await turkceKelimeVarMi(val))) {
      document.getElementById("secret-feedback-2").textContent = "Bu kelime Türkçe sözlükte yok!";
      return;
    }
    secretWords[1] = val;
    document.getElementById("secret2").style.display = "none";
    startGuessPhase(player1, player2, secretWords, container, onComplete);
  };
}
function startGuessPhase(p1, p2, secretWords, container, onComplete) {
  const guessPhase = container.querySelector("#guess-phase");
  guessPhase.style.display = "";
  const guessTurn = container.querySelector("#guess-turn");
  const guessInput = container.querySelector("#guess-input");
  const guessBtn = container.querySelector("#guess-btn");
  const guessFeedback = container.querySelector("#guess-feedback");
  const matchBoard = container.querySelector("#match-board");
  const matchResultArea = container.querySelector("#match-result-area");
  let timerDiv = document.createElement("div");
  timerDiv.id = "guess-timer";
  guessPhase.insertBefore(timerDiv, guessFeedback);
  let giveUpBtn = document.createElement("button");
  giveUpBtn.id = "giveup-btn";
  giveUpBtn.textContent = "Pes Et";
  guessPhase.insertBefore(giveUpBtn, guessFeedback);
  let boards = [[], []];
  let tries = [0, 0];
  let found = [false, false];
  let finished = false;
  let activePlayer = 0;
  let phase = 0;
  let startTime = null;
  let timerSeconds = 0;
  let timerInterval = null;
  let playerTimes = [0, 0];
  let playerTimerStarted = [false, false];
  function formatTime(sec) {
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    return (m > 0 ? m + "dk " : "") + s + "sn";
  }
  function updateTimer() {
    if (finished) return;
    timerSeconds++;
    timerDiv.textContent = `Geçen Süre: ${formatTime(timerSeconds)}`;
  }
  function startTimer() {
    timerDiv.textContent = `Geçen Süre: 0sn`;
    clearInterval(timerInterval);
    timerSeconds = 0;
    timerInterval = setInterval(updateTimer, 1000);
    startTime = Date.now();
  }
  function stopTimer() {
    clearInterval(timerInterval);
    if (startTime !== null) {
      playerTimes[activePlayer] += Math.round((Date.now() - startTime) / 1000);
      startTime = null;
    }
  }
  function resetTimer() {
    stopTimer();
    timerSeconds = 0;
    timerDiv.textContent = `Geçen Süre: 0sn`;
  }
  function updateUI() {
    guessTurn.textContent = `${activePlayer === 0 ? p1.name : p2.name} tahmin yapıyor`;
    renderBoard(matchBoard, boards[activePlayer]);
    guessInput.value = "";
    guessInput.maxLength = wordLength;
    guessInput.focus();
    guessFeedback.textContent = "";
    matchResultArea.innerHTML = "";
    timerDiv.textContent = `Geçen Süre: ${formatTime(timerSeconds)}`;
    giveUpBtn.style.display = "";
  }
  giveUpBtn.onclick = () => {
    if (finished) return;
    stopTimer();
    resetTimer();
    finished = true;
    let winner, loser, msg, detail;
    if (phase === 0) {
      msg = `<b>${p2.name}</b> kazandı!`;
      winner = p2.name; loser = p1.name;
      detail = `${p1.name} pes etti.`;
      if (gameMode === "tournament") { p1.eliminated = true; eliminated.push(p1); }
    } else {
      msg = `<b>${p1.name}</b> kazandı!`;
      winner = p1.name; loser = p2.name;
      detail = `${p2.name} pes etti.`;
      if (gameMode === "tournament") { p2.eliminated = true; eliminated.push(p2); }
    }
    matchResultArea.innerHTML = `
      <div style="margin:16px 0 0 0;padding:12px 0 0 0;">
        <div style="font-size:1.09em;color:var(--accent-dark);margin-bottom:6px;">${msg}</div>
        <div style="color:#444;font-size:0.99em;margin-bottom:12px;">${detail}</div>
        <button id="continue-btn" style="margin-top:5px;">Sonraki Maça Geç</button>
      </div>
    `;
    guessFeedback.textContent = "";
    guessBtn.disabled = true;
    guessInput.disabled = true;
    giveUpBtn.style.display = "none";
    document.getElementById("continue-btn").onclick = () => {
      if (gameMode === "tournament") onComplete(winner, loser);
      else onComplete();
    };
  };
  async function handleGuess() {
    if (finished) return;
    const guess = guessInput.value.toLowerCase().trim();
    if (!validateWord(guess)) {
      guessFeedback.textContent = "Sadece harf ve uygun uzunluk!";
      return;
    }
    guessFeedback.textContent = "Kelime kontrol ediliyor...";
    if (!(await turkceKelimeVarMi(guess))) {
      guessFeedback.textContent = "Bu kelime Türkçe sözlükte yok!";
      return;
    }
    if (!playerTimerStarted[activePlayer]) {
      startTimer();
      playerTimerStarted[activePlayer] = true;
    }
    tries[activePlayer]++;
    const feedback = getFeedback(guess, secretWords[1 - activePlayer]);
    boards[activePlayer].push({ guess, feedback });
    renderBoard(matchBoard, boards[activePlayer]);
    if (guess === secretWords[1 - activePlayer]) {
      found[activePlayer] = true;
      stopTimer();
      playerTimes[activePlayer] = playerTimes[activePlayer] || timerSeconds;
      resetTimer();
      if (phase === 0) {
        phase = 1;
        activePlayer = 1;
        guessFeedback.innerHTML = `${p1.name} kelimeyi <b>${tries[0]}. denemede buldu!</b><br>${p2.name} şimdi ${tries[0]} denemede bulmaya çalışacak.`;
        setTimeout(() => {
          boards[1] = [];
          tries[1] = 0;
          renderBoard(matchBoard, boards[1]);
          updateUI();
          startTime = null;
        }, 1300);
        return;
      } else {
        finished = true;
        stopTimer();
        playerTimes[activePlayer] = playerTimes[activePlayer] || timerSeconds;
        let msg = "", winner = null, loser = null, detail = "";
        if (tries[1] < tries[0]) {
          msg = `<b>${p2.name}</b> daha az denemede bildi ve kazandı!`;
          detail = `${p2.name}: ${tries[1]} deneme, ${playerTimes[1]} sn<br>${p1.name}: ${tries[0]} deneme, ${playerTimes[0]} sn`;
          winner = p2.name; loser = p1.name;
          if (gameMode === "tournament") { p1.eliminated = true; eliminated.push(p1); }
        } else if (tries[0] < tries[1]) {
          msg = `<b>${p1.name}</b> kazandı!`;
          detail = `${p1.name}: ${tries[0]} deneme, ${playerTimes[0]} sn<br>${p2.name}: ${tries[1]} deneme, ${playerTimes[1]} sn`;
          winner = p1.name; loser = p2.name;
          if (gameMode === "tournament") { p2.eliminated = true; eliminated.push(p2); }
        } else {
          if (playerTimes[0] < playerTimes[1]) {
            msg = `<b>${p1.name}</b> eşit denemede <b>${playerTimes[0]} sn</b> ile <b>${playerTimes[1]} sn</b>'den daha hızlı buldu ve kazandı!`;
            detail = `${p1.name}: ${tries[0]} deneme, ${playerTimes[0]} sn<br>${p2.name}: ${tries[1]} deneme, ${playerTimes[1]} sn`;
            winner = p1.name; loser = p2.name;
            if (gameMode === "tournament") { p2.eliminated = true; eliminated.push(p2); }
          } else if (playerTimes[1] < playerTimes[0]) {
            msg = `<b>${p2.name}</b> eşit denemede <b>${playerTimes[1]} sn</b> ile <b>${playerTimes[0]} sn</b>'den daha hızlı buldu ve kazandı!`;
            detail = `${p2.name}: ${tries[1]} deneme, ${playerTimes[1]} sn<br>${p1.name}: ${tries[0]} deneme, ${playerTimes[0]} sn`;
            winner = p2.name; loser = p1.name;
            if (gameMode === "tournament") { p1.eliminated = true; eliminated.push(p1); }
          } else {
            msg = `Deneme ve süreler eşit! Rastgele biri üst tura geçiyor!`;
            winner = Math.random() < 0.5 ? p1.name : p2.name;
            loser = winner === p1.name ? p2.name : p1.name;
            detail = `Her şey eşit! Şanslı: <b>${winner}</b>`;
            if (gameMode === "tournament") {
              if (winner === p1.name) { p2.eliminated = true; eliminated.push(p2); }
              else { p1.eliminated = true; eliminated.push(p1); }
            }
          }
        }
        matchResultArea.innerHTML = `
          <div style="margin:16px 0 0 0;padding:12px 0 0 0;">
            <div style="font-size:1.09em;color:var(--accent-dark);margin-bottom:6px;">${msg}</div>
            <div style="color:#444;font-size:0.99em;margin-bottom:12px;">${detail}</div>
            <button id="continue-btn" style="margin-top:5px;">Sonraki Maça Geç</button>
          </div>
        `;
        guessFeedback.textContent = "";
        guessBtn.disabled = true;
        guessInput.disabled = true;
        giveUpBtn.style.display = "none";
        document.getElementById("continue-btn").onclick = () => {
          if (gameMode === "tournament") onComplete(winner, loser);
          else onComplete();
        };
        return;
      }
    }
    updateUI();
  }
  guessBtn.onclick = handleGuess;
  guessInput.addEventListener("keyup", e => {
    if (e.key === "Enter") handleGuess();
  });
  updateUI();
}
function drawSvgBracket() {
  const svg = document.getElementById('svg-bracket');
  const container = document.getElementById('svg-bracket-container');
  const rounds = bracketGames.length;
  const matchesFirst = bracketGames[0]?.length || 1;
  const width = Math.max(500, rounds * 150);
  const height = Math.max(330, matchesFirst * 60 + 40);
  svg.setAttribute('width', width);
  svg.setAttribute('height', height);
  svg.innerHTML = '';
  const hGap = 120;
  const vGap = 60;
  const boxH = 24;
  const boxW = 90;
  for (let r=0; r<rounds; r++) {
    const matches = bracketGames[r];
    const matchGap = vGap * Math.pow(2, r);
    for (let m=0; m<matches.length; m++) {
      const x = r * hGap + 20;
      const y = (m * Math.pow(2, r) + 0.5) * vGap + 30;
      let p1 = matches[m].p1 || "?";
      let p2 = matches[m].p2 || "?";
      let winner = matches[m].winner;
      if (r < bracketGames.length-1) {
        const nextX = (r+1)*hGap + 20;
        const nextY = ((Math.floor(m/2)*Math.pow(2,r+1)) + Math.pow(2,r)/2 + 0.5) * vGap + 30;
        svg.innerHTML += `<line x1="${x+boxW}" y1="${y}" x2="${nextX}" y2="${nextY}" stroke="#b0b4ba" stroke-width="2"/>`;
      }
      svg.innerHTML += `<rect x="${x}" y="${y-boxH/2}" width="${boxW}" height="${boxH}" rx="7" fill="#fff" stroke="#b0b4ba" stroke-width="2"/>`;
      svg.innerHTML += `<text x="${x+boxW/2}" y="${y-5}" class="svg-bracket-text${winner===p1?' svg-bracket-winner':''}${p1==='?'?' svg-bracket-current':''}">${p1}</text>`;
      svg.innerHTML += `<rect x="${x}" y="${y+boxH/2}" width="${boxW}" height="${boxH}" rx="7" fill="#fff" stroke="#b0b4ba" stroke-width="2"/>`;
      svg.innerHTML += `<text x="${x+boxW/2}" y="${y+boxH/2+boxH/2-5}" class="svg-bracket-text${winner===p2?' svg-bracket-winner':''}${p2==='?'?' svg-bracket-current':''}">${p2}</text>`;
    }
    let roundTitle = getRoundName(r+1, bracketPlayers.length);
    svg.innerHTML += `<text x="${r*hGap+20+boxW/2}" y="18" font-size="14" fill="#3267d6" font-weight="600" text-anchor="middle">${roundTitle}</text>`;
  }
}
showBracketBtn.onclick = () => {
  drawSvgBracket();
  bracketModal.style.display = "flex";
};
bracketClose.onclick = () => {
  bracketModal.style.display = "none";
};
window.onclick = function(event) {
  if (event.target == bracketModal) {
    bracketModal.style.display = "none";
  }
};
function shuffle(arr) {
  for (let i = arr.length-1; i>0; i--) {
    let j = Math.floor(Math.random()*(i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
function validateWord(word) {
  return word.length === wordLength && /^[a-zA-ZçğıöşüÇĞİÖŞÜ]+$/.test(word);
}
function getFeedback(guess, answer) {
  let feedback = Array(wordLength).fill("gray");
  let used = Array(wordLength).fill(false);
  guess = guess.split(""); answer = answer.split("");
  for (let i = 0; i < wordLength; i++) {
    if (guess[i] === answer[i]) {
      feedback[i] = "green"; used[i] = true;
    }
  }
  for (let i = 0; i < wordLength; i++) {
    if (feedback[i] === "green") continue;
    for (let j = 0; j < wordLength; j++) {
      if (!used[j] && guess[i] === answer[j]) {
        feedback[i] = "yellow";
        used[j] = true;
        break;
      }
    }
  }
  return feedback;
}
</script>
</body>
</html>